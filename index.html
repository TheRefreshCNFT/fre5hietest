<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Frac5</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background-color: #000000;
}

/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 0px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
}

/* Modal Content (Image) */
.modal-content {
  margin: auto;
  display: block;
  width: 80%;
  max-width: 700px;
}


/* Add Animation - Zoom in the Modal */
.modal-content, #caption {
  animation-name: zoom;
  animation-duration: 0.6s;
}

@keyframes zoom {
  from {transform:scale(0)}
  to {transform:scale(1)}
}

/* The Close Button */
.close {
  position: absolute;
  top: 15px;
  right: 35px;
  color: #f1f1f1;
  font-size: 40px;
  font-weight: bold;
  transition: 0.3s;
}

.close:hover,
.close:focus {
  color: #bbb;
  text-decoration: none;
  cursor: pointer;
}
</style>
</head>

<body>
  <center>
<canvas id="canvas1" style="object-fit: contain; top: 0; left: 0; position: absolute;"></canvas>
<img id="myImg" style="object-fit: contain; top: 0; left: 0; position: absolute;"></img>
</center>


<!-- The Modal -->
<div id="myModal" class="modal">
  <!-- The Close Button -->
  <span class="close">&times;</span>

  <!-- Modal Content (The Image) -->
  <img class="modal-content" id="img01" style="object-fit: contain; width: 100vw; height: 100vh;" width="4096" height="4096">

</div>
<script>

/*Release canvas from memory*/
function releaseCanvas(canvas) {
  canvas.width = 1;
  canvas.style.width = "1vw";
  canvas.height = 1;
  canvas.style.height = "1vh";
  const ctx = canvas.getContext('2d');
  ctx && ctx.clearRect(0, 0, 1, 1);
}

function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1) + min);
  }
  function getRandomDec(min,max) {
  	  return Math.random() * (max - min) + min;
  	}
function randomColor() {
  return '#'+(Math.random() * 0xFFFFFF << 0).toString(16).padStart(6, '0');
  }

//globals
  var size1 = getRandomDec(128,129);
  var x = 319;
  var y = 50;
  var x1 = 481;
  var y1 = 600;
  var color1 = "#B7D21D";
  var color2 = "#3F3E6F";
  var color3 = "#603F35";
  var color4 = "#5CA676";
  var color5 = "#67266C";
  var offX = getRandomInt(0, 0);
  var offY = getRandomInt(0, 0);
  var lineW = getRandomInt(0.01, 0.02);
  var blur = getRandomInt(10, 20);

window.addEventListener('load', function() {
  const canvas = document.getElementById('canvas1');
  const ctx = canvas.getContext('2d');
  canvas.width = 4096;
  canvas.height = 4096;
  canvas.style.width = "100vw";
  canvas.style.height = '100vh';
  //canvas settings
  var lineJoin = ['round', 'bevel', 'miter'];
  var s = 300;
  var grd = ctx.createRadialGradient(s, s, 50, s, s, 300);
  grd.addColorStop(Math.random(), color1);
  grd.addColorStop(Math.random(), color2);
  grd.addColorStop(Math.random(), color3);
  grd.addColorStop(Math.random(), color4);
  grd.addColorStop(Math.random(), color5);
  ctx.fillStyle = "#000000";
  ctx.fillRect(0, 0, 4096, 4096);
  ctx.lineWidth = lineW;
  ctx.lineCap = 'round';
  ctx.strokeStyle = "#ffffff";
  ctx.fillStyle = grd;
  ctx.shadowColor = '#222222';
  ctx.shadowOffsetX = offX;
  ctx.shadowOffsetY = offY;
  ctx.shadowBlur = blur;

  const ctx2 = canvas.getContext('2d');
  var grd1 = ctx2.createRadialGradient(2048, 2048, 500, 2048, 2048, 2048);
  grd1.addColorStop(0, "lightgray");
  grd1.addColorStop(1, "gray");
  ctx2.fillStyle = grd1;
  ctx2.fillRect(0, 0, 4096, 4096);


  class Fractal {
    constructor(canvasWidth, canvasHeight){
      this.canvasWidth = canvasWidth;
      this.canvasHeight = canvasHeight;
      this.size = this.canvasWidth * 0.01;
      this.sides = size1;
    }
    draw(context){
      context.save();
      context.translate(this.canvasWidth/2, this.canvasHeight/2);
      context.scale(2, 2);
      context.rotate(0);


      for (let i = 0; i < this.sides; i++){
        this.#drawLine(context);
        context.rotate((Math.PI * 35)/this.sides);
      }

      context.restore();
    }



    #drawLine(context){
      for (let i = 0; i < lineJoin.length; i++) {
      context.lineJoin = lineJoin[i];
      context.beginPath();
      context.moveTo(x-30, y-30 + i * 140);
      context.lineTo(x-30, y-30 + i * 140);
      context.lineTo(x1-30, y1-30 + i * 140);
      context.lineTo(-35, -45 + i * 140);
      context.arc(x, y, 200, 0, 8 * Math.PI);
      context.stroke();
    }}
  }

  const fractal1 = new Fractal(canvas.width, canvas.height);
  fractal1.draw(ctx);


  });


//modal
  let timer;
  document.getElementById("canvas1").addEventListener('click', event => {
    if (event.detail === 1) {
    timer = setTimeout(() => {
      ('click');
      location.reload();
    }, 200)
    }
  });
  document.getElementById("canvas1").addEventListener('dblclick', event => {
    clearTimeout(timer);
    ('dblclick');
    modalUp();
  })

  /*Run release even when they refresh not with click (F5, refresh button, closing page)*/
  			window.addEventListener('pagehide', (event) => {
  				/*Release every canvas*/
  					var canvases = document.getElementsByTagName("canvas");
  					var canvasesList = Array.prototype.slice.call(canvases);
              		canvasesList.forEach(releaseCanvas);
  			});
  //save image on mobile
   			function modalUp() {

               	var inputVal = canvas1.toDataURL({format: 'image/png', quality:1, width:4096, height:4096});
  				var img = new Image();
  				img.src = inputVal;

  				var modal = document.getElementById("myModal");

  				// Get the image and insert it inside the modal - use its "alt" text as a caption

  				var modalImg = document.getElementById("img01");


  				  modal.style.display = "block";
  				  modalImg.src = inputVal;

  				// Get the <span> element that closes the modal
  				var span = document.getElementsByClassName("close")[0];

  				// When the user clicks on <span> (x), close the modal
  				span.onclick = function() {
  				  	modal.style.display = "none";
  				}

           	}
</script>

</body>
</html>
